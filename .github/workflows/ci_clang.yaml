name: Tests with clang

on: [push]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install dependencies
        run: sudo apt-get update && sudo apt-get install -y clang libeigen3-dev libgmp-dev libflint-dev libntl-dev

      - name: Build project
        run: |
          export CPLUS_INCLUDE_PATH="$(pwd)":"/usr/include/flint":"/usr/include/eigen3":${CPLUS_INCLUDE_PATH}
          export LIBRARY_PATH="/usr/lib":${LIBRARY_PATH}
          g++ test/pe_test.c -o ./pe_test.out --std=c++20 -O3 -march=native -mtune=native -lgmpxx -lmpfr -lflint -lntl -lgmp -DENABLE_ASSERT=0 -DTRY_TO_USE_INT128=1 -DENABLE_OPENMP=0 -DENABLE_EIGEN=1 -DENABLE_GMP=1 -DENABLE_FLINT=0 -DENABLE_MPFR=1 -DENABLE_NTL=1 -DENABLE_ZMQ=0 -DENABLE_LIBBF=0 -DENABLE_PRIME_COUNT=0 -DENABLE_PRIME_SIEVE=0 -DTEST_ALL -DCONTINUOUS_INTEGRATION_TEST -DNO_SUPER_TEST

      - name: Run tests
        run: ./pe_test.out
